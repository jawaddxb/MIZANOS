FROM python:3.12-slim

WORKDIR /app

ENV PYTHONPATH=/app

COPY pyproject.toml .
RUN pip install --no-cache-dir -e .

COPY apps/api/ ./apps/api/
COPY packages/common/ ./packages/common/
COPY infra/alembic/ ./infra/alembic/
COPY infra/alembic.ini ./infra/alembic.ini

COPY infra/start-api.sh ./start-api.sh
RUN chmod +x ./start-api.sh

EXPOSE ${PORT:-8000}

CMD ["./start-api.sh"]
